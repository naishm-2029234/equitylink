<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leaflet Map with Large Layer Control Panel</title>
    <!-- Include Leaflet and D3 libraries -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="main.js" defer></script>
    <link rel="stylesheet" href="map.css">
    <style>
        body, html {
            height: 100%;
            margin: 0;
            overflow: hidden;
        }

        #container {
            display: flex;
            height: 100%;
            overflow: hidden;
        }

        #map-container {
            flex: 1;
            position: relative;
            height: 100%;
        }

        #map {
            height: 100%;
            width: 100%;
            float: left;
        }

        #layer-control {
            width: 25%;
            float: left;
            background-color: #fff;
            border: 1px solid #ccc;
            padding: 10px;
            font-family: Arial, sans-serif;
            font-size: 14px;
            overflow-y: auto;
        }

        .category-checkbox {
            margin-bottom: 5px;
        }

        /* Set SVG dimensions */
        svg {
            width: 800px;
            height: 400px;
        }
    </style>
</head>
<body>
    <div id="container">
        <div id="map-container">
            <div id="map"></div>
        </div>
        <div id="layer-control"></div>
    </div>

    <script>
        // Initialize Leaflet map
        var map = L.map('map').setView([46.2306, -119.0922], 10);

        // Add tile layer
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Â© OpenStreetMap contributors'
        }).addTo(map);

        // Load GeoJSON data for borders
        var bordersLayer;

        // Declare bordersLayer outside of the fetch callback
        bordersLayer = L.geoJSON(null, {
            style: function(feature) {
                return {
                    color: 'purple', // Border color
                    weight: 2, // Border weight
                    fillOpacity: 0 // No fill
                };
            }
        }).addTo(map);

        fetch('tricities.geojson')
            .then(response => response.json())
            .then(data => {
                bordersLayer.addData(data); // Add GeoJSON data to bordersLayer
            });

        // Sample data
        var data = [
            { name: 'Marker 1', category: 'Schools', coordinates: [46.2114, -119.1372], info: 'Info for Marker 1' },
            { name: 'Marker 2', category: 'Libraries', coordinates: [46.2857, -119.2831], info: 'Info for Marker 2' },
            // Add more markers as needed
        ];

        // Create marker layers
        var markersByCategory = {};
        data.forEach(function(d) {
            if (!markersByCategory[d.category]) {
                markersByCategory[d.category] = L.layerGroup();
            }
            var marker = L.marker(d.coordinates);
            marker.bindPopup('<div><strong>Name:</strong> ' + d.name + '<br><strong>Info:</strong> ' + d.info + '</div>');
            marker.addTo(markersByCategory[d.category]);
        });

        // Add layer control
        var layerControl = L.control.layers(null, markersByCategory);
        layerControl.addTo(map);

        // Create large layer control panel using D3
        var layerControlDiv = d3.select('#layer-control');

        // Append checkboxes for each category
        Object.keys(markersByCategory).forEach(function(category) {
            var checkbox = layerControlDiv.append('div')
                .attr('class', 'category-checkbox')
                .html('<input type="checkbox" id="' + category + '" checked> <label for="' + category + '">' + category + '</label>');

            // Toggle layer visibility when checkbox is clicked
            checkbox.select('input').on('change', function() {
                var isChecked = d3.select(this).property('checked');
                if (isChecked) {
                    map.addLayer(markersByCategory[category]);
                } else {
                    map.removeLayer(markersByCategory[category]);
                }
            });
        });
    </script>
</body>
</html>
